let host=new Object;host.url="http://studenter.miun.se/~olan1700/dt057g/php_rest/";const reqData=async e=>(await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}})).json(),getData=(e,t)=>{t(e).then(e=>{displayData(e)}).catch(e=>{console.log("Fetch error "+e)})},PostData=async(e,t)=>{if("GET"===t){return(await fetch(e,{method:"GET"})).json()}return(await fetch(e,{method:"DELETE"})).json()},addData=(e,t,n,r)=>{const a=JSON.stringify({courseID:e,coursename:t,progression:n,courseSyllabus:r});fetch(host.url,{method:"POST",headers:{"Content-Type":"application/json"},body:a}).then(e=>{200===e.status?(message("Kurs tillagd!",!0,"wrapper"),getData(host.url,reqData),document.getElementById("course").reset(),e.json()):message("Kurs inte tillagd!",!0,"wrapper")}).then(e=>{console.log(e)}).catch(e=>console.error("Fetch error:",e))},editData=e=>{document.querySelector("#course_edit h3").innerHTML="Ändra kurs "+e.coursename;let t=[...document.getElementById("course_edit").elements].filter(e=>"editCourse"!==e.id);const n=[e.courseID,e.coursename,e.progression,e.courseSyllabus];let r=0;t.forEach(e=>{e.value=n[r],r++}),document.getElementById("course_edit").addEventListener("submit",(function(t){t.preventDefault();let n=[...document.getElementById("course_edit").elements].filter(e=>"editCourse"!==e.id),r=[];n.forEach(e=>{r.push(e.value)});const a=JSON.stringify({ID:e.ID,courseID:r[0],coursename:r[1],progression:r[2],courseSyllabus:r[3]});fetch(host.url,{method:"PUT",headers:{"Content-Type":"application/json"},body:a}).then(e=>{if(200!==e.status)return document.getElementById("edit_form").style.display="none",void message("Kurs inte ändrad!",!0,"wrapper");document.getElementById("edit_form").style.display="none",message("Kurs ändrad!",!0,"wrapper"),getData(host.url,reqData),e.json()}).then(e=>{console.log(e)}).catch(e=>console.error("Fetch error:",e))}))},displayData=e=>{document.getElementById("display_data")&&document.getElementById("display_data").remove(),parent=document.getElementById("courses"),table=document.createElement("table"),table.id="display_data",tablehead=document.createElement("thead"),tableBody=document.createElement("tbody"),tr=document.createElement("tr"),parent.appendChild(table),tr.innerHTML+="<th>KursKod</th><th>Kursnamn</th><th>Progression</th><th>Kursplan</th><th>Ändra</th>",table.appendChild(tr),table.appendChild(tr);e.forEach(e=>{tr=document.createElement("tr"),tr.innerHTML="<td>"+e.courseID+"</td><td>"+e.coursename+"</td><td>"+e.progression+"</td><td><a href="+e.courseSyllabus+" target='_blank'>Webblänk</a></td><td class='edit' id='"+e.ID+"'>Ändra</td><td class='remove' id='"+e.courseID+"'>&#10005;</td>",table.appendChild(tr)}),document.querySelectorAll(".remove").forEach(e=>{e.addEventListener("click",(function(){window.confirm("Säker på att du vill ta bort kursen?")&&PostData(host.url+"?courseID="+this.getAttribute("id")).then(e=>{console.log(e),this.parentNode.remove(),message("Kurs raderad!",!0,"wrapper")}).catch(e=>{console.log("Fetch error "+e)})}))}),document.querySelectorAll(".edit").forEach(e=>{e.addEventListener("click",(function(){PostData(host.url+"?ID="+this.getAttribute("id"),"GET").then(e=>{document.getElementById("edit_form").style.display="block",editData(e)}).catch(e=>{console.log("Fetch error "+e)})}))})};window.onload=()=>{getData(host.url,reqData)};const handleMessage=()=>new Promise(e=>{setTimeout(()=>{e("finished")},3e3)}),removeMessage=async()=>{await new Promise(e=>{setTimeout(()=>{e("finished")},3e3)})&&document.getElementById("message")&&document.getElementById("message").remove()},message=(e,t,n)=>{let r=document.getElementById(n);if(document.getElementById("message"))for(;document.getElementById("message").lastChild;)document.getElementById("message").lastChild.remove();if(document.getElementById("message"))Array.isArray(e)?(document.getElementById("message").innerHTML="<h4>Det har blivit något fel! </h4>",e.forEach(e=>{document.getElementById("message").innerHTML+="<h4>"+e+"</h4>"})):(r.insertBefore(document.getElementById("message"),document.getElementById("course")),document.getElementById("message").innerHTML="<h3>"+e+"</h3>",t&&removeMessage());else{let n=document.createElement("div");n.id="message",Array.isArray(e)?(r.appendChild(n),n.innerHTML="<h4>Det har blivit något fel! </h4>",e.forEach(e=>{n.innerHTML+="<h4>"+e+"</h4>"})):(r.insertBefore(n,document.getElementById("course")),n.innerHTML="<h3>"+e+"</h3>",t&&removeMessage())}};document.getElementById("course").addEventListener("submit",(function(e){formelement=[...this.elements].filter(e=>"addCourse"!==e.id);let t=[],n=[];e.preventDefault(),formelement.forEach(e=>{"progression"===e.getAttribute("id")?e.value.length>1?n.push("Fältet "+e.name+" kan bara var en bokstav långt"):e.value.length>0?t.push(e.value):n.push("Fältet "+e.name+" är tomt!"):e.value.length<1?n.push("Fältet "+e.name+" är tomt!"):t.push(e.value)}),n.length>0?message(n,!1,"wrapper"):addData(...t)})),document.getElementById("close").addEventListener("click",(function(){confirm("säker på att du vill avbryta?")&&(document.getElementById("edit_form").style.display="none")}));